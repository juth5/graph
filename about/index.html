<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/phi-jp/meltline@v0.1.15/meltline.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="./index.js"></script>
  <style>
    li {
      list-style: none;
    }
  </style>
</head>
<body>
<div class="h100vh border border-gray bg-white f flex-column">
  <header class="h50 border f fbw fm flex-fixed p20">
    <button class="button bg-orange text-white">ホームへ戻る</button>
    <div class="f fm">
      <div class="bold fs20 mr4">南畑発電所</div>
    </div>


    <div>
      <button class="button bg-blue text-white mr12" id="powerPlantButton">発電所選択</button>
    </div>
  </header>
  <div class="f h-full">
    <div class="w-full px12 pt12">
      <div id="chart-wrapper" style="width: 100%; height: 90%;" class="border">
        <canvas id="scatterChart"></canvas>
      </div>
    <div class="f fh mt12">
      <div class="f fm">
        <input type="number" class="input w80">
        <div class="px6">年</div>
      </div>
      <div class="f fm">
        <input type="number" class="input w60">
        <div class="px6">月</div>
      </div>
      <div class="f fm">
        <input type="number" class="input w60">
        <div class="px6">日</div>
      </div>
      <div class="px12">〜</div>
      <div class="f fm">
        <input type="number" class="input w80">
        <div class="px6">年</div>
      </div>
      <div class="f fm">
        <input type="number" class="input w60">
        <div class="px6">月</div>
      </div>
      <div class="f fm">
        <input type="number" class="input w60">
        <div class="px6">日</div>
      </div>
      <button class="button bg-green text-white mr8">変更</button>
      <div>
        <button class="bg-white f fh border circle s30" title="初期値にリセット">
          <img src="./更新ボタン.svg" class='s20' alt="">
        </button>
      </div>
    </div>

    </div>

    <div class="w315 h-full flex-fixed p8 border">
      <div class="mb8">
        <div class="f mb4">
          <div class="mt4 bold">期間</div>
        </div>
        <div class="f fm">
          <div class="f fm">
            <select name="" id="" class="border border-black p6 rounded-4">
              <option value="2025">2025</option>
              <option value="2024">2024</option>
            </select>
            <div class="mx4">年</div>
          </div>
          <div class="f fm">
            <select name="" id="" class="border border-black p6 rounded-4">
              <option value="12">12</option>
              <option value="11">11</option>
            </select>
            <div class="ml4">月</div>
          </div>
          <div class="mx4">〜</div>
          <div class="f fm">
            <select name="" id="" class="border border-black p6 rounded-4">
              <option value="2025">2025</option>
              <option value="2024">2024</option>
            </select>
            <div class="mx4">年</div>
          </div>
          <div class="f fm">
            <select name="" id="" class="border border-black p6 rounded-4">
              <option value="12">12</option>
              <option value="11">11</option>
            </select>
            <div class="ml4">月</div>
          </div>
        </div>
      </div>
      <ul class="rounded-4">
        <li class="mb8 light-gray p6 rounded-4 border">
          <div class="bold">X軸</div>
          <select name="" id="" class="w256 border border-black p6 rounded-4 mb6">
            <option value="">未選択</option>
            <option value="2025">ガイドベーン開度</option>
            <option value="2024">有効電力</option>
          </select>
          <div class="f fb mb6">
            <div>
              <div class="fs12 bold">X軸最低値</div>
              <input type="number" class="input p2 h30 w80 fs12 mr8">
            </div>
            <div class="mr12">
              <div class="fs12 bold">X軸最高値</div>
              <input type="number" class="input p2 h30 w80 fs12">
            </div>
            <div>
              <button class="bg-green text-white button w50 p2 py6 mr4">変更</button>
            </div>
            <div>
              <button class="bg-white f fh border circle s30" title="初期値にリセット">
                <img src="./更新ボタン.svg" class='s20' alt="">
              </button>
            </div>
          </div>
          
        </li>
        <li class="mb8 light-gray p6 rounded-4 border">
          <div class="bold">Y軸</div>
          <select name="" id="" class="w256 border border-black p6 rounded-4 mb6">
            <option value="">未選択</option>
            <option value="2025">ガイドベーン開度</option>
            <option value="2024">水位</option>
          </select>
          <div class="f fb mb6">
            <div>
              <div class="fs12 bold">Y軸最低値</div>
              <input type="number" class="input p2 h30 w80 fs12 mr8">
            </div>
            <div class="mr12">
              <div class="fs12 bold">Y軸最高値</div>
              <input type="number" class="input p2 h30 w80 fs12">
            </div>
            <div>
              <button class="bg-green text-white button w50 p2 py6 mr4">変更</button>
            </div>
            <div>
              <button class="bg-white f fh border circle s30" title="初期値にリセット">
                <img src="./更新ボタン.svg" class='s20' alt="">
              </button>
            </div>
            
          </div>
          
        </li>
      </ul>
      <div class="f mb4">
        <div class="mt4 bold">許容帯比率</div>
      </div>
      <div class="f fm mb20">
        <div class="mr6">±</div>
        <input type="number" class="input p2 h30 w80 fs12">
        <div class="ml6">％</div>
      </div>
      <div class="flex-fixed mb6">
        <button class="button w128 mr16 bg-blue text-white">取得して描画</button>
        <button class="button w128 bg-red text-white">クリア</button>
      </div>
    </div>
  </div>
  <div>

  </div>
</div>

  <script>
    window.addEventListener('load', function() {
  const ctx = document.getElementById('scatterChart').getContext('2d');

  // X=出力, Y=開度 の理想ライン（開度は10刻み、少し拡大）
  const idealLine = [
    { x: 4, y: 12 },
    { x: 8, y: 24 },
    { x: 13, y: 36 },
    { x: 17, y: 48 },
    { x: 21, y: 60 },
    { x: 25, y: 72 },
    { x: 27, y: 84 },
    { x: 29, y: 96 },
    { x: 31, y: 108 },
    { x: 33, y: 120 }
  ];

  // ±10%ライン（出力のみ変動）
  const plus10Line = idealLine.map(p => ({ x: p.x * 1.1, y: p.y }));
  const minus10Line = idealLine.map(p => ({ x: p.x * 0.9, y: p.y }));

  // 散布点を理想ライン近くに配置
  const scatterPoints = [];
  for (let i = 0; i < 30; i++) {
    const x = Math.random() * 33; // 出力は 0〜33 の範囲
    const lower = idealLine.findLast(p => p.x <= x);
    const upper = idealLine.find(p => p.x >= x);
    let idealY;
    if (lower && upper && lower !== upper) {
      const ratio = (x - lower.x) / (upper.x - lower.x);
      idealY = lower.y + (upper.y - lower.y) * ratio;
    } else {
      idealY = lower?.y ?? upper?.y ?? 0;
    }
    const noise = (Math.random() - 0.5) * 8; // ±8程度の開度ずれ
    const y = (i % 2 === 0) ? idealY + noise : idealY - noise;

    scatterPoints.push({ x, y });
  }

  const chart = new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [
        {
          label: '実測値（30点）',
          data: scatterPoints,
          type: 'scatter',
          backgroundColor: 'rgba(255, 0, 200, 0.8)',
          pointRadius: 5 // 少し大きめ
        },
        {
          label: '理想ライン（上ゾーン用）',
          data: idealLine,
          type: 'line',
          borderColor: 'transparent',
          fill: false,
          tension: 0
        },
        {
          label: '+10%ライン',
          data: plus10Line,
          type: 'line',
          borderColor: 'red',
          borderDash: [5, 5],
          borderWidth: 1.5,
          fill: '-1',
          backgroundColor: 'rgba(255, 0, 0, 0.05)',
          tension: 0
        },
        {
          label: '理想ライン（下ゾーン用）',
          data: idealLine,
          type: 'line',
          borderColor: 'transparent',
          fill: false,
          tension: 0
        },
        {
          label: '-10%ライン',
          data: minus10Line,
          type: 'line',
          borderColor: 'blue',
          borderDash: [5, 5],
          borderWidth: 1.5,
          fill: '-1',
          backgroundColor: 'rgba(0, 0, 255, 0.05)',
          tension: 0
        },
        {
          label: '理想ライン',
          data: idealLine,
          type: 'line',
          borderColor: 'green',
          borderWidth: 2,
          fill: false,
          tension: 0
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { min: 0, max: 35, title: { display: true, text: '出力' } },
        y: { min: 0, max: 120, ticks: { stepSize: 10 }, title: { display: true, text: '開度' } }
      }
    }
  });



});
  </script>
</body>
</html>
